<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.ygo.dao.ArticleMapper">

    <resultMap id="ArticleInfo" type="com.example.ygo.entity.Article" extends="BaseResultMap">
        <result column="categoryName" property="categoryName"/>
        <collection property="articlelabels" ofType="com.example.ygo.entity.Articlelabel" javaType="java.util.List">
            <id column="labelId" property="id"/>
            <result column="labelName" property="name"/>
            <result column="labelStatus" property="status"/>
        </collection>
    </resultMap>

    <!-- 获得权限及其角色列表 -->
    <select id="findArticleInfoByExample" parameterType="com.example.ygo.entity.ArticleExample" resultMap="ArticleInfo">
        SELECT
            a.id,
            a.user_id,
            a.category_id,
            a.title,
            a.content,
            a.pic,
            a.like_num,
            a.view_num,
            a.create_time,
            a.update_time,
            a.delete_time,
            a.`status`,
            ac.`name` categoryName,
            al.id labelId,
            al.`name` labelName,
            al.`status` labelStatus
        FROM
            `y_article` a,
            y_article_category ac,
            y_article_label al,
            y_article_with_label awl
        <if test="_parameter != null">
            <where>
                a.category_id = ac.id
                AND awl.article_id = a.id
                AND awl.label_id = al.id
                <if test="_parameter != null"> AND </if>
                <foreach collection="oredCriteria" item="criteria" separator="or">
                    <if test="criteria.valid">
                        <trim prefix="(" prefixOverrides="and" suffix=")">
                            <foreach collection="criteria.criteria" item="criterion">
                                <choose>
                                    <when test="criterion.noValue">
                                        and a.${criterion.condition}
                                    </when>
                                    <when test="criterion.singleValue">
                                        and a.${criterion.condition} #{criterion.value}
                                    </when>
                                    <when test="criterion.betweenValue">
                                        and a.${criterion.condition} #{criterion.value} and a.#{criterion.secondValue}
                                    </when>
                                    <when test="criterion.listValue">
                                        and a.${criterion.condition}
                                        <foreach close=")" collection="criterion.value" item="listItem" open="(" separator=",">
                                            a.#{listItem}
                                        </foreach>
                                    </when>
                                </choose>
                            </foreach>
                        </trim>
                    </if>
                </foreach>
            </where>
        </if>
    </select>

</mapper>

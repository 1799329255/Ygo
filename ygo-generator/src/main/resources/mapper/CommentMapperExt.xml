<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.ygo.dao.CommentMapper">

    <resultMap id="CommentInfo" type="com.example.ygo.entity.Comment" extends="BaseResultMap">
        <association property="user" javaType="com.example.ygo.entity.User">
            <id column="uid" jdbcType="BIGINT" property="id" />
            <result column="uname" jdbcType="VARCHAR" property="name" />
            <result column="upassword" jdbcType="VARCHAR" property="password" />
            <result column="uage" jdbcType="INTEGER" property="age" />
            <result column="upic" jdbcType="VARCHAR" property="pic" />
            <result column="usex" jdbcType="INTEGER" property="sex" />
            <result column="uphone" jdbcType="BIGINT" property="phone" />
            <result column="uemail" jdbcType="VARCHAR" property="email" />
            <result column="uaddress" jdbcType="VARCHAR" property="address" />
            <result column="uban_time" jdbcType="TIMESTAMP" property="banTime" />
            <result column="ucreate_time" jdbcType="TIMESTAMP" property="createTime" />
            <result column="uupdate_time" jdbcType="TIMESTAMP" property="updateTime" />
            <result column="udelete_time" jdbcType="TIMESTAMP" property="deleteTime" />
            <result column="ustatus" jdbcType="INTEGER" property="status" />
        </association>
        <association property="article" javaType="com.example.ygo.entity.Article">
            <id column="aid" jdbcType="BIGINT" property="id" />
            <result column="auser_id" jdbcType="BIGINT" property="userId" />
            <result column="acategory_id" jdbcType="BIGINT" property="categoryId" />
            <result column="atitle" jdbcType="VARCHAR" property="title" />
            <result column="acontent" jdbcType="VARCHAR" property="content" />
            <result column="apic" jdbcType="VARCHAR" property="pic" />
            <result column="alike_num" jdbcType="BIGINT" property="likeNum" />
            <result column="aview_num" jdbcType="BIGINT" property="viewNum" />
            <result column="acreate_time" jdbcType="TIMESTAMP" property="createTime" />
            <result column="aupdate_time" jdbcType="TIMESTAMP" property="updateTime" />
            <result column="adelete_time" jdbcType="TIMESTAMP" property="deleteTime" />
            <result column="astatus" jdbcType="INTEGER" property="status" />
        </association>
    </resultMap>

    <!-- 获得权限及其角色列表 -->
    <select id="findCommentInfoByExample" parameterType="com.example.ygo.entity.CommentExample" resultMap="CommentInfo">
        SELECT
        <if test="distinct">
            distinct
        </if>
            c.id,
            c.article_id,
            c.user_id,
            c.content,
            c.pic,
            c.like_num,
            c.create_time,
            c.update_time,
            c.delete_time,
            c.`status`,
            u.id uid,
            u.`name` uname,
            u.age uage,
            u.pic upic,
            u.sex usex,
            u.phone uphone,
            u.email uemail,
            u.address uaddress,
            u.ban_time uban_time,
            u.create_time ucreate_time,
            u.update_time uupdate_time,
            u.delete_time udelete_time,
            u.`status` ustatus,
            a.id aid,
            a.user_id auser_id,
            a.category_id acategory_id,
            a.title atitle,
            a.content acontent,
            a.pic apic,
            a.like_num alike_num,
            a.view_num aview_num,
            a.create_time acreate_time,
            a.update_time aupdate_time,
            a.delete_time adelete_time,
            a.`status` astatus
        FROM
            (
                SELECT * FROM `y_comment`

                <where>
                    <if test="_parameter != null">
                        <foreach collection="oredCriteria" item="criteria" separator="or">
                            <if test="criteria.valid">

                                <trim prefix="(" prefixOverrides="and" suffix=")">
                                    <foreach collection="criteria.criteria" item="criterion">
                                        <choose>
                                            <when test="criterion.noValue">
                                                and ${criterion.condition}
                                            </when>
                                            <when test="criterion.singleValue">
                                                and ${criterion.condition} #{criterion.value}
                                            </when>
                                            <when test="criterion.betweenValue">
                                                and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                                            </when>
                                            <when test="criterion.listValue">
                                                and ${criterion.condition}
                                                <foreach close=")" collection="criterion.value" item="listItem" open="(" separator=",">
                                                    #{listItem}
                                                </foreach>
                                            </when>
                                        </choose>
                                    </foreach>
                                </trim>
                            </if>
                        </foreach>
                    </if>
                </where>

                <if test="orderByClause != null">
                    order by ${orderByClause}
                </if>

                <if test="rows != null">
                    <if test="offset != null">
                        limit ${offset}, ${rows}
                    </if>
                    <if test="offset == null">
                        limit ${rows}
                    </if>
                </if>
            ) c
            LEFT JOIN y_user u ON c.user_id = u.id
            LEFT JOIN y_article a ON c.article_id = a.id


    </select>

</mapper>

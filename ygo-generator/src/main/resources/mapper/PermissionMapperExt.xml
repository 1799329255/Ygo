<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.ygo.dao.PermissionMapper">

    <resultMap id="PermissionWithRole" type="com.example.ygo.entity.Permission" extends="BaseResultMap">
        <collection property="roles" ofType="com.example.ygo.entity.Role" javaType="java.util.List">
            <id column="rid" property="id"/>
            <result column="rname" property="name"/>
            <result column="rnickname" property="nickname"/>
            <result column="rstatus" property="status"/>
        </collection>
    </resultMap>

    <!-- 获得权限及其角色列表 -->
    <select id="findPermissionsWithRoles" resultMap="PermissionWithRole">
        SELECT
	        p.id,p.url,p.parent_id,p.`name`,p.`status`,
            r.id AS rid,r.`name` AS rname,r.nickname AS rnickname,r.`status` AS rstatus
        FROM
            y_permission p,
            y_role_with_permission rp,
            y_role r
        WHERE
            rp.permission_id=p.id
            AND rp.role_id=r.id
            AND p.`status`!=0
            AND r.`status`!=0
        ORDER BY
            r.id
    </select>

</mapper>
